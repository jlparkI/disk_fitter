# disk_masher_1.0

## Summary

Disk Masher is a GUI application designed for fitting and visualizing the data generated by two different microbiological
assays. Disk Masher plots and fits the data with a user-selected algorithm to find optimal cutoffs for predicting the 
results of the second assay from the outcome of the first. Error rates are automatically calculated and the analyst can 
export the results to Excel in an appropriate format for further use.


## Installation

Disk Masher is available for download as a precompiled executable for 64-bit Windows (see the Releases tab above). 
Simply download, place in your preferred directory and double-click to run. This is the easy way to obtain & run 
Disk Masher.

While Disk Masher is preferably run on Windows, it can also be run on any platform by starting it from the command line,
although this approach requires some more familiarity with Python and with your system's commandline.
You must have Python 3 (preferably >3.5) installed. Next, clone the repo, create a new virtual environment and
install the indicated libraries as shown below (instructions shown are for Linux / MacOS).

```
git clone  https://github.com/jlparkI/disk_masher_1.0
cd disk_masher_1.0
python3 -m venv env
source env/bin/activate
pip install matplotlib numpy pandas scikit-learn PyQt5
cd scripts
python main.py
```

## Background

When a patient has an infection, doctors need to determine whether a bacterial strain can be killed by the antibiotic they would like to use or is resistant to it. They can do this in several ways:

+ By growing the strain in broth containing diluted concentrations of the antibiotic to determine the smallest concentration that stops the strain from growing (the “Minimum Inhibitory Concentration” or MIC). This is the preferred and most reliable test but is also the most inconvenient. In order to run it the hospital/lab has to have the pure antibiotic in powder form which may not be available.

+ By growing the bacteria in the presence of a disk containing the antibiotic. The antibiotic diffuses outwards from the disk. The more resistant the bacteria are, the closer they will grow to the disk, and the smaller the zone around the disk will be. The zone around the disk is measured in millimeters. This is less reliable than the MIC test but is easier for most hospitals because pharmaceutical companies provide disks that hospitals can use.

+ Occasionally antibiotics are also tested by measuring the MIC using a strip called an “E-Test”. This measurement gives an MIC like the broth dilution test but is less reliable than the broth dilution test.

Frequently, a hospital just wants to know whether they can treat a patient with an antibiotic or not. So they divide MICs into three categories based on cutoff values called “breakpoints”. These categories are “Susceptible”, “Intermediate” and “Resistant”. If the bug is susceptible, it’s ok to go ahead and treat. If the bug is intermediate, maybe this antibiotic can be used, this decision is up to the doctor, and if it’s resistant definitely do not use this antibiotic. If the breakpoints are 2 and 16, for example, a bug with an MIC less than 2 is susceptible (good to treat), and a bug with an MIC less than 16 but greater than 2 is intermediate. The problem is that these categories are set based on broth MICs, whereas the hospital may need to use a disk test or E-test instead (tests 2 and 3). 

So microbiologists must find out how the disk and (sometimes) E-test measurements correspond to the broth MICs. The goal is to pick disk breakpoints/cutoffs and E-test breakpoints/cutoffs that give results which match the results of the gold-standard MIC test as reliably as possible. So if based on the MIC test, strains A-G should be classified as “Resistant” and strains H-Z should be classified as “Susceptible”, we need to pick a disk cutoff that would classify as many of them correctly as possible. 
In other words, we can think of this as a simple supervised learning prediction task. Given a vector [1,disk zone], we need to correctly predict membership in an output category belonging to the set {0,1,2}, where 0 is susceptible, 1 is intermediate and 2 is resistant. We want to find two linear boundaries (disk zone cutoff for susceptible vs intermediate and disk zone cutoff for intermediate vs resistant) that maximize the accuracy of predictions made using the disks. Two simple approaches for choosing such boundaries are logistic regression, which tries to maximize the probability of correctly choosing output categories but is easily thrown off by outliers in smaller datasets, and a depth-1 decision tree classifier, which tries to maximize the purity of the populations on either side of the split point and is far more robust to outliers.

DiskMasher incorporates the following features:

+ Provides a simple and intuitive GUI interface that even non- math/computer-savvy microbiologists will find easy to use;
+ Offers the analyst the ability to import either MIC vs E-test MIC or MIC vs disk data from Excel, automatically fit and plot the data and the error rates using either logistic regression or decision tree based approaches;
+ Offers the analyst the ability to manually choose cutoffs if the analyst prefers this approach to the auto-fit procedure and see their effect on the error rate;
+ Finally, the analyst can export the heatmap plot, error rate table and other results to Excel for further review.
